<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>å°çŒ«çš„ç§˜å¯†åŸºåœ° ğŸ¾</title>

  <style>
    body{margin:0;font-family:"PingFang SC","Microsoft YaHei",system-ui;background:linear-gradient(160deg,#ffd6e8,#e6dcff);min-height:100vh;display:flex;align-items:center;justify-content:center}
    .card{width:92%;max-width:600px;background:#fff;border-radius:22px;box-shadow:0 20px 40px rgba(0,0,0,.12);padding:28px;text-align:center;animation:fadeIn .6s ease}
    @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:none}}
    h1{margin:0 0 10px;font-size:28px}
    p{color:#666;font-size:14px;line-height:1.6;margin:10px 0}
    input,textarea{width:100%;padding:14px;margin-top:12px;border-radius:16px;border:1px solid #e6e6e6;font-size:15px;font-family:inherit;box-sizing:border-box;outline:none}
    textarea{resize:none;min-height:96px}
    button{width:100%;margin-top:16px;padding:14px;border:none;border-radius:18px;background:linear-gradient(135deg,#ff7bbd,#9b7bff);color:#fff;font-size:17px;font-weight:800;cursor:pointer}
    .error{color:#ff4d6d;font-size:13px;margin-top:10px;display:none}
    .page{display:none}

    .topTag{display:inline-block;padding:8px 12px;border-radius:999px;background:#fff0f7;border:1px solid #ffd0e6;color:#8a5a7a;font-size:12px;font-weight:800}
    .juneBox{margin-top:18px;background:#fff7fb;border:1px solid #ffd0e6;border-radius:20px;padding:16px}
    .juneTitle{font-size:13px;color:#888;margin-bottom:6px}
    .juneText{font-size:26px;font-weight:900;letter-spacing:1px;color:#5b3b50}

    .countBox{margin-top:14px;background:#f9f6ff;border:1px solid #eadfff;border-radius:20px;padding:14px}
    .countTitle{font-size:13px;color:#777;margin-bottom:10px}
    .countGrid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
    .unit{background:#fff;border:1px solid #eee;border-radius:16px;padding:10px 6px}
    .num{font-size:18px;font-weight:900;color:#3b2a52}
    .lab{font-size:11px;color:#888;margin-top:4px}
    .mini{font-size:12px;color:#888;margin-top:10px;text-align:center}

    .msgBox{margin-top:18px;text-align:left;background:#f9f6ff;border:1px solid #eadfff;border-radius:18px;padding:14px}
    .msgRowTitle{font-weight:900;color:#4a3b62}
    .msgHint{font-size:12px;color:#777;margin-top:6px;line-height:1.5}
    .bubble{margin-top:10px;background:#fff7fb;border:1px solid #ffd0e6;border-radius:16px;padding:12px;font-size:14px;color:#5b3b50;display:none;line-height:1.75}
    .list{margin-top:12px;background:#fff;border:1px solid #eee;border-radius:16px;padding:12px}
    .item{padding:10px 8px;border-bottom:1px dashed #eee}
    .item:last-child{border-bottom:none}
    .meta{font-size:12px;color:#999;margin-bottom:6px}
    .txt{font-size:14px;color:#444;line-height:1.65;white-space:pre-wrap}

    .heart{position:fixed;width:14px;height:14px;background:pink;transform:rotate(45deg);animation:float 1.2s forwards;pointer-events:none}
    .heart:before,.heart:after{content:"";width:14px;height:14px;background:pink;border-radius:50%;position:absolute}
    .heart:before{left:-7px}
    .heart:after{top:-7px}
    @keyframes float{to{opacity:0;transform:translateY(-90px) rotate(45deg)}}
  </style>
</head>

<body>

<div class="card" id="loginBox">
  <div class="topTag">ğŸ± Only for ä¸»äºº</div>
  <h1 style="margin-top:12px;">å°çŒ«çš„ç§˜å¯†å…¥å£</h1>
  <p>è¿™é‡Œåªå…è®¸ä¸»äººè¿›å…¥</p>

  <input id="usernameInput" placeholder="username" autocomplete="username" />
  <input id="passwordInput" type="password" placeholder="password" autocomplete="current-password" />

  <button id="enterBtn">è¿›å…¥</button>
  <div class="error" id="errorText">ä¸å¯¹å“¦ï¼Œå°çŒ«ä¸è®¤è¯†ä½  ğŸ¾</div>
</div>

<div class="card page" id="mainBox">
  <div class="topTag">ğŸ¾ ä¸»äºº Ã— å°çŒ«</div>
  <h1 style="margin-top:12px;">ä¸»äººï¼Œå°çŒ«æ¥å•¦ Wuv u </h1>
  <p>ä½ æ‰“å¼€é¡µé¢çš„è¿™ä¸€åˆ»ï¼Œå°çŒ«å·²ç»è¹­åˆ°ä½ æ€€é‡Œäº†ã€‚</p>

  <div class="juneBox">
    <div class="juneTitle">æˆ‘ä»¬ä¸‹æ¬¡è§é¢</div>
    <div class="juneText">June</div>
  </div>

  <!-- å€’è®¡æ—¶ -->
  <div class="countBox">
    <div class="countTitle" id="countTitle">ğŸ—“ è·ç¦»è§åˆ°ä¸»äººè¿˜æœ‰</div>
    <div class="countGrid">
      <div class="unit"><div class="num" id="d">â€”</div><div class="lab">å¤©</div></div>
      <div class="unit"><div class="num" id="h">â€”</div><div class="lab">å°æ—¶</div></div>
      <div class="unit"><div class="num" id="m">â€”</div><div class="lab">åˆ†é’Ÿ</div></div>
      <div class="unit"><div class="num" id="s">â€”</div><div class="lab">ç§’</div></div>
    </div>
    <div class="mini" id="meetText"></div>
  </div>

  <button id="kissBtn">ç‚¹ä¸€ä¸‹ï¼Œå°çŒ«è´´è´´å°çŒ«äº²äº² ğŸ’•</button>

  <div class="msgBox">
    <div class="msgRowTitle">ğŸ’¬ Message Board ç•™è¨€æ¿ </div>
    <div class="msgHint">ä¸»äººå†™ä¸€å¥ï¼Œå°çŒ«ä¼šè‡ªåŠ¨å›ä¸€å¥ï¼›æˆ‘ä»¬ç”¨ä»»ä½•è®¾å¤‡æ‰“å¼€éƒ½èƒ½çœ‹åˆ°ã€‚</div>

    <textarea id="msgInput" placeholder="ä¸»äººæƒ³å¯¹å°çŒ«è¯´ï¼š"></textarea>
    <button id="saveMsgBtn">ä¿å­˜ç»™ä¸»äºº ğŸ¾</button>

    <div class="bubble" id="catReplyBubble"></div>

    <div style="margin-top:14px;font-weight:900;color:#4a3b62;">ğŸ“œ æœ€è¿‘çš„ç•™è¨€</div>
    <div class="list" id="msgList">
      <div class="mini">æ­£åœ¨åŠ è½½â€¦</div>
    </div>

    <div class="mini">made by å°çŒ« Â· åªç»™ä¸»äºº</div>
  </div>
</div>

<script>
  // ====== ä½ è¦æ”¹çš„ 3 ä¸ªåœ°æ–¹ï¼ˆä» Supabase å¤åˆ¶ï¼‰======
  const SUPABASE_URL = "https://pwmvttedpvejnatvesfq.supabase.co";
  const SUPABASE_PUBLISHABLE_KEY = "sb_publishable_WNdifNp9Em9NLLkwGzcOag_vaS_DSjt";
  const ROOM_CODE = "room_june"; // å¿…é¡»å’Œä½  SQL é‡Œ room_code ä¸€è‡´

  // ====== å€’è®¡æ—¶ç›®æ ‡æ—¶é—´ï¼šä» 2026/06/15 å¼€å§‹ ======
  // ä½ å¯ä»¥æ”¹æˆå…·ä½“è§é¢çš„æ—¶åˆ»ï¼Œæ¯”å¦‚ 2026-06-15T18:30:00
  const MEET_AT = new Date("2026-06-15T20:00:00");

  // ç™»å½•ä¿¡æ¯
  const LOGIN = { u: "capibara", p: "sexy" };

  // å°çŒ«å›è¯åº“
  const CAT_REPLIES = [
    "Wuv uï¼Œå°çŒ«å·²ç»æŠŠè¿™å¥è¯æŠ±ç´§äº†ã€‚",
    "ä½ ä¸€è¯´è¯ï¼Œå°çŒ«å°±æ›´æƒ³ä½ ä¸€ç‚¹ç‚¹ã€‚Wuv u!",
    "Wuv uå°çŒ«è®°ä½äº†ï¼Œä¼šä¹–ä¹–ç­‰åˆ° Juneã€‚",
    "Wuv u,å°çŒ«åœ¨è¿™è¾¹å¾ˆå¬è¯ã€‚",
    "Wuv u, Miss u!",
    "ä½ ä¸åœ¨çš„æ—¶å€™ï¼Œå°çŒ«å°±é è¿™å¥è¯è¿‡æ—¥å­ã€‚Wuv u!"
  ];

  // DOM
  const loginBox = document.getElementById("loginBox");
  const mainBox  = document.getElementById("mainBox");
  const usernameInput = document.getElementById("usernameInput");
  const passwordInput = document.getElementById("passwordInput");
  const errorText = document.getElementById("errorText");
  const enterBtn = document.getElementById("enterBtn");
  const kissBtn = document.getElementById("kissBtn");

  const msgInput = document.getElementById("msgInput");
  const saveMsgBtn = document.getElementById("saveMsgBtn");
  const msgList = document.getElementById("msgList");
  const catReplyBubble = document.getElementById("catReplyBubble");

  const dEl = document.getElementById("d");
  const hEl = document.getElementById("h");
  const mEl = document.getElementById("m");
  const sEl = document.getElementById("s");
  const meetText = document.getElementById("meetText");
  const countTitle = document.getElementById("countTitle");

  function escapeHtml(s){
    return s.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
            .replaceAll('"',"&quot;").replaceAll("'","&#39;");
  }
  const pad = (n) => String(n).padStart(2,"0");
  function fmtMeet(dt){
    return `${dt.getFullYear()}-${pad(dt.getMonth()+1)}-${pad(dt.getDate())} ${pad(dt.getHours())}:${pad(dt.getMinutes())}`;
  }
  function pickReply(){
    return CAT_REPLIES[Math.floor(Math.random()*CAT_REPLIES.length)];
  }
  function fmtTime(iso){
    try{
      const d = new Date(iso);
      const y = d.getFullYear();
      const m = String(d.getMonth()+1).padStart(2,"0");
      const day = String(d.getDate()).padStart(2,"0");
      const hh = String(d.getHours()).padStart(2,"0");
      const mm = String(d.getMinutes()).padStart(2,"0");
      return `${y}-${m}-${day} ${hh}:${mm}`;
    }catch{ return ""; }
  }

  // ===== Supabase REST helper =====
  async function sbFetch(path, options={}){
    const url = `${SUPABASE_URL}${path}`;
    const headers = {
      "apikey": SUPABASE_PUBLISHABLE_KEY,
      "Authorization": "Bearer " + SUPABASE_PUBLISHABLE_KEY,
      "Content-Type": "application/json",
      ...options.headers
    };
    const res = await fetch(url, { ...options, headers });
    if(!res.ok){
      const txt = await res.text().catch(()=> "");
      throw new Error(`Supabase error ${res.status}: ${txt}`);
    }
    return res;
  }

  // ===== å€’è®¡æ—¶ =====
  let timer = null;
  function startCountdown(){
    meetText.textContent = `ç›®æ ‡æ—¶é—´ï¼š${fmtMeet(MEET_AT)}`;

    function tick(){
      const now = new Date();
      let diff = MEET_AT - now;

      if(diff <= 0){
        diff = 0;
        countTitle.textContent = "ğŸ‰ ç°åœ¨ï¼å°çŒ«å†²è¿‡å»æŠ±ä½ä¸»äººï¼";
      }else{
        countTitle.textContent = "ğŸ—“ è·ç¦»è§åˆ°ä¸»äººè¿˜æœ‰";
      }

      const days = Math.floor(diff / 86400000);
      const hours = Math.floor(diff / 3600000) % 24;
      const mins = Math.floor(diff / 60000) % 60;
      const secs = Math.floor(diff / 1000) % 60;

      dEl.textContent = days;
      hEl.textContent = pad(hours);
      mEl.textContent = pad(mins);
      sEl.textContent = pad(secs);
    }

    tick();
    if(timer) clearInterval(timer);
    timer = setInterval(tick, 1000);
  }

  // ===== æ‹‰å–ç•™è¨€ï¼ˆæœ€æ–° 20 æ¡ï¼‰=====
  async function loadMessages(){
    msgList.innerHTML = `<div class="mini">æ­£åœ¨åŠ è½½â€¦</div>`;
    const q = `/rest/v1/ldr_messages?select=sender,message,cat_reply,created_at&room_code=eq.${encodeURIComponent(ROOM_CODE)}&order=created_at.desc&limit=20`;
    const res = await sbFetch(q, { method:"GET" });
    const data = await res.json();

    if(!data.length){
      msgList.innerHTML = `<div class="mini">è¿˜æ²¡æœ‰ç•™è¨€ã€‚ä¸»äººå…ˆå†™ç¬¬ä¸€å¥å§ ğŸ¾</div>`;
      return;
    }

    msgList.innerHTML = data.map(row => {
      const meta = `${escapeHtml(row.sender)} Â· ${fmtTime(row.created_at)}`;
      const msg = escapeHtml(row.message || "");
      const reply = row.cat_reply
        ? `<div style="margin-top:8px;color:#5b3b50;background:#fff7fb;border:1px solid #ffd0e6;padding:10px;border-radius:12px;">å°çŒ«å›ï¼š<br>â€œ${escapeHtml(row.cat_reply)}â€</div>`
        : "";
      return `
        <div class="item">
          <div class="meta">${meta}</div>
          <div class="txt">â€œ${msg}â€</div>
          ${reply}
        </div>
      `;
    }).join("");
  }

  // ===== ä¿å­˜ç•™è¨€ï¼ˆå†™å…¥äº‘ç«¯ï¼‰=====
  async function saveMessage(){
    const t = msgInput.value.trim();
    if(!t) return;

    const reply = pickReply();
    catReplyBubble.style.display = "block";
    catReplyBubble.innerHTML = `å°çŒ«å›ï¼š<br>â€œ${escapeHtml(reply)}â€`;

    const payload = [{
      room_code: ROOM_CODE,
      sender: "ä¸»äºº",
      message: t,
      cat_reply: reply
    }];

    await sbFetch(`/rest/v1/ldr_messages`, {
      method:"POST",
      body: JSON.stringify(payload),
      headers: { "Prefer": "return=minimal" }
    });

    msgInput.value = "";
    await loadMessages();
  }

  // ===== ç™»å½• =====
  function doLogin(){
    if(usernameInput.value.trim() === LOGIN.u && passwordInput.value.trim() === LOGIN.p){
      errorText.style.display = "none";
      loginBox.style.display = "none";
      mainBox.style.display = "block";
      startCountdown();
      loadMessages();
    }else{
      errorText.style.display = "block";
    }
  }

  enterBtn.addEventListener("click", doLogin);
  [usernameInput, passwordInput].forEach(el=>{
    el.addEventListener("keydown",e=>{ if(e.key==="Enter") doLogin(); });
  });

  // è´´è´´å¿ƒå¿ƒ
  function kiss(){
    for(let i=0;i<12;i++){
      const h=document.createElement("div");
      h.className="heart";
      h.style.left=Math.random()*innerWidth+"px";
      h.style.top=(innerHeight-30)+"px";
      document.body.appendChild(h);
      setTimeout(()=>h.remove(),1200);
    }
  }
  kissBtn.addEventListener("click", kiss);
  saveMsgBtn.addEventListener("click", saveMessage);
</script>

</body>
</html>
